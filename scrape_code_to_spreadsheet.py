from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.keys import Keys
import re
import sys
import xlsxwriter 
  



def page_source_get():
    global page_source
    page_source = browser.page_source

def cleanhtml(raw_html):
  cleanr = re.compile('<.*?>')
  cleantext = re.sub(cleanr, '', raw_html)
  return cleantext

def doubleClick():
    browser.find_element_by_id("NextButton").click()
    browser.find_element_by_id("NextButton").click()
    
def mainSequence():
    browser.get(start_url)

    browser.find_element_by_name("NextButton").click()

    #Survey code and input time
    browser.find_element_by_name("SurveyCode").send_keys(str(survey_code))

    browser.find_element_by_name("InputHour").click()
    browser.find_element_by_name("InputHour").send_keys(Keys.DOWN)

    browser.find_element_by_name("InputMinute").click()
    browser.find_element_by_name("InputMinute").send_keys(Keys.DOWN)

    browser.find_element_by_name("InputMeridian").click()
    browser.find_element_by_name("InputMeridian").send_keys(Keys.DOWN)

    browser.find_element_by_name("NextButton").click()

    #Order Type
    doubleClick()

    #Num ppl in party
    doubleClick()

    #Satisfaction Overall
    doubleClick()

    #Satisfaction with...
    doubleClick()

    #Satisfaction with... temperature+value
    doubleClick()

    #Satisfaction with... fries,burger
    doubleClick()

    #problems with experience
    doubleClick()

    #Recommend
    doubleClick()

    #HJ popular, favourite
    doubleClick()

    #Design of HJs
    doubleClick()

    #what main item
    doubleClick()

    #what side items... does not allow double click
    doubleClick()

    #times ordered
    doubleClick()

    #reason visit
    doubleClick()

    #fast food been most
    doubleClick()

    #gender age
    doubleClick()

    #zip code
    browser.find_element_by_id("NextButton").click()
    




print("Initialising Window Settings ...", end =" ")
chrome_options = Options()
chrome_options.add_argument("--disable-extensions")
chrome_options.add_argument("--disable-gpu")
chrome_options.add_argument("--headless")
chrome_options.add_argument('--ignore-certificate-errors')
browser = webdriver.Chrome(options=chrome_options)
print("Success")

#Initialise
workbook = xlsxwriter.Workbook('validation_codes.xlsx') 
worksheet = workbook.add_worksheet()

row=0
column=0
count=0

#Starting value which will be incremented from
survey_code = "10111834510527"

#Number of Validation Codes to scrape
code_limit = 1

start_url = "https://www.myhjexperience.com/"

while True:
    try:
        mainSequence()
    except:
        element=browser.find_element_by_class_name("ValCode").text
        li = str(element).split(" ")
        print(str(survey_code))
        print(li[2])


        worksheet.write(row, column, str(survey_code)) 
        worksheet.write(row, column + 1, str(li[2]))
        # incrementing the value of row by one 
        # with each iteration 
        row += 1
       
        survey_code = int(survey_code)+1
        count += 1

        if count >= code_limit:
            print("Finished scraping")
            workbook.close()
            sys.exit()

workbook.close()









